# 首页交互重构方案：状态一体化与智能引导 (Integrated State & Smart Guide)

## 1. 核心理念 (Core Philosophy)
*   **去技术化**：隐藏用户不关心的底层状态（API连接、DOM注入），除非发生故障。
*   **重业务流**：聚焦于“评分细则”这一阅卷的核心依赖，将其配置入口前置化、显性化。
*   **减法设计**：废弃冗余的“检测清单 (Checklist)”，与“任务卡片”合并为一个统一的“智能状态区”。

## 2. 交互状态定义 (State Definitions)

在光球下方设定一个固定高度的 **“智能状态区”**，根据系统状态动态切换内容：

### 状态 A：待配置 (Action Required)
*   **触发条件**：系统检测到当前题号（如第16题）在本地无评分细则缓存。
*   **UI 表现**：
    *   **光球**：灰色，不可点击，显示 `⛔` 图标。
    *   **状态区**：显示一个高亮的**引导卡片**。
        *   文案：“⚠️ 第 16 题尚未配置规则”
        *   主按钮：“✨ 立即生成” (点击侧滑呼出编辑器)
        *   副链接：“📂 导入...”

### 状态 B：已就绪 (Ready)
*   **触发条件**：环境正常且规则已配置。
*   **UI 表现**：
    *   **光球**：靛蓝色 (Indigo)，呼吸动画，显示 `⚡` 图标。
    *   **状态区**：显示一条**极简状态条**。
        *   内容：“✅ 第 16 题规则已生效 (15分)”
        *   交互：点击该区域可快速预览/微调规则。

### 状态 C：系统故障 (System Error)
*   **触发条件**：API 断连、网页 Content Script 失联、Token 耗尽。
*   **UI 表现**：
    *   **光球**：红色，颤抖动画，显示 `🔌` 或 `❌` 图标。
    *   **状态区**：显示红色**故障排查条**。
        *   文案：“无法连接到网页” 或 “API 额度不足”
        *   按钮：“刷新重试” 或 “去充值”

## 3. 动态流转示例 (User Flow)

1.  **切题检测**：老师在智学网点击“下一题”（从15切到16）。
2.  **指纹重置**：`content.js` 捕捉变化，发送 `RESET_STATE`。Side Panel 进入初始化。
3.  **静默自检**：后台快速检查 API 和 DOM 连接（用户无感）。
4.  **规则查询**：系统发现 Storage 中没有 `rubric:16`。
5.  **UI 呈现**：进入 **[状态 A：待配置]**。光球变灰，弹出“生成规则”按钮。
6.  **用户操作**：老师点击生成 -> 上传图片 -> AI 生成 -> 确认保存。
7.  **状态变更**：保存成功瞬间，界面切入 **[状态 B：已就绪]**。光球点亮，随时可阅。

## 4. 实施建议 (Implementation)

*   **组件化**：创建一个 `SmartStatusArea` 组件，内部根据 `useAppStore` 的 `health` 和 `rubric` 状态渲染不同内容。
*   **防御性编程**：确保在 **[状态 A]** 下，光球的点击事件被拦截，防止用户在无规则情况下强行阅卷。
*   **过渡动画**：状态切换时（如配置完成后），增加一个 `Fade In/Out` 动画，增强“完成任务”的愉悦感。
