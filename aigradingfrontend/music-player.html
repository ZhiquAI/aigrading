<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Èü≥‰πêÊí≠ÊîæÂô®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .player-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .album-art {
            width: 100%;
            aspect-ratio: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .album-art::before {
            content: 'üéµ';
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .song-info {
            text-align: center;
            margin-bottom: 24px;
            color: white;
        }

        .song-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .song-artist {
            font-size: 16px;
            opacity: 0.8;
        }

        .progress-container {
            margin-bottom: 24px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .time-info {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn.play-btn {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .control-btn.play-btn:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .control-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .play-btn svg {
            width: 32px;
            height: 32px;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .volume-icon {
            color: white;
            cursor: pointer;
        }

        .volume-slider {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .volume-fill {
            height: 100%;
            background: white;
            border-radius: 2px;
            width: 70%;
            transition: width 0.1s linear;
        }

        .playlist {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
        }

        .playlist::-webkit-scrollbar {
            width: 6px;
        }

        .playlist::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .playlist::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            color: white;
            font-weight: 600;
        }

        .add-song-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: transform 0.2s ease;
        }

        .add-song-btn:hover {
            transform: scale(1.05);
        }

        .playlist-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .playlist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(4px);
        }

        .playlist-item.active {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .playlist-item.playing .item-icon {
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .item-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .item-info {
            flex: 1;
        }

        .item-title {
            color: white;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .item-artist {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .item-duration {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .remove-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            padding: 4px;
            opacity: 0;
            transition: all 0.2s ease;
        }

        .playlist-item:hover .remove-btn {
            opacity: 1;
        }

        .remove-btn:hover {
            color: #ef4444;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.6);
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <!-- Album Art -->
        <div class="album-art"></div>

        <!-- Song Info -->
        <div class="song-info">
            <div class="song-title" id="currentTitle">ÈÄâÊã©‰∏ÄÈ¶ñÊ≠åÊõ≤</div>
            <div class="song-artist" id="currentArtist">--</div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="time-info">
                <span id="currentTime">0:00</span>
                <span id="duration">0:00</span>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="control-btn" id="shuffleBtn" title="ÈöèÊú∫Êí≠Êîæ">
                <svg viewBox="0 0 24 24"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
            </button>
            <button class="control-btn" id="prevBtn" title="‰∏ä‰∏ÄÈ¶ñ">
                <svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
            </button>
            <button class="control-btn play-btn" id="playBtn" title="Êí≠Êîæ/ÊöÇÂÅú">
                <svg id="playIcon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                <svg id="pauseIcon" viewBox="0 0 24 24" style="display: none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>
            <button class="control-btn" id="nextBtn" title="‰∏ã‰∏ÄÈ¶ñ">
                <svg viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
            </button>
            <button class="control-btn" id="repeatBtn" title="Âæ™ÁéØÊí≠Êîæ">
                <svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
            </button>
        </div>

        <!-- Volume Control -->
        <div class="volume-control">
            <div class="volume-icon" id="volumeIcon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                </svg>
            </div>
            <div class="volume-slider" id="volumeSlider">
                <div class="volume-fill" id="volumeFill"></div>
            </div>
        </div>

        <!-- Playlist -->
        <div class="playlist">
            <div class="playlist-header">
                <span>Êí≠ÊîæÂàóË°®</span>
                <button class="add-song-btn" id="addSongBtn">+ Ê∑ªÂä†Ê≠åÊõ≤</button>
            </div>
            <div class="playlist-items" id="playlistItems">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                    </svg>
                    <p>Êí≠ÊîæÂàóË°®‰∏∫Á©∫</p>
                    <p style="font-size: 12px; margin-top: 8px;">ÁÇπÂáª"Ê∑ªÂä†Ê≠åÊõ≤"ÂºÄÂßã</p>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" accept="audio/*" style="display: none;" multiple>

    <script>
        // Player State
        const state = {
            playlist: [],
            currentIndex: 0,
            isPlaying: false,
            isShuffle: false,
            repeatMode: 0, // 0: no repeat, 1: repeat all, 2: repeat one
            volume: 0.7,
            audio: new Audio()
        };

        // DOM Elements
        const elements = {
            playBtn: document.getElementById('playBtn'),
            playIcon: document.getElementById('playIcon'),
            pauseIcon: document.getElementById('pauseIcon'),
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            shuffleBtn: document.getElementById('shuffleBtn'),
            repeatBtn: document.getElementById('repeatBtn'),
            progressBar: document.getElementById('progressBar'),
            progressFill: document.getElementById('progressFill'),
            currentTime: document.getElementById('currentTime'),
            duration: document.getElementById('duration'),
            currentTitle: document.getElementById('currentTitle'),
            currentArtist: document.getElementById('currentArtist'),
            volumeSlider: document.getElementById('volumeSlider'),
            volumeFill: document.getElementById('volumeFill'),
            playlistItems: document.getElementById('playlistItems'),
            addSongBtn: document.getElementById('addSongBtn'),
            fileInput: document.getElementById('fileInput')
        };

        // Format time (seconds to mm:ss)
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Load and play song at index
        function loadSong(index) {
            if (state.playlist.length === 0) return;

            state.currentIndex = index;
            const song = state.playlist[index];

            state.audio.src = song.url;
            state.audio.load();

            elements.currentTitle.textContent = song.title;
            elements.currentArtist.textContent = song.artist || 'Êú™Áü•Ëâ∫ÊúØÂÆ∂';

            updatePlaylistUI();

            if (state.isPlaying) {
                state.audio.play();
            }
        }

        // Play/Pause toggle
        function togglePlay() {
            if (state.playlist.length === 0) return;

            if (state.isPlaying) {
                state.audio.pause();
            } else {
                state.audio.play();
            }
            state.isPlaying = !state.isPlaying;
            updatePlayButton();
        }

        // Update play/pause button
        function updatePlayButton() {
            if (state.isPlaying) {
                elements.playIcon.style.display = 'none';
                elements.pauseIcon.style.display = 'block';
            } else {
                elements.playIcon.style.display = 'block';
                elements.pauseIcon.style.display = 'none';
            }
        }

        // Play next song
        function playNext() {
            if (state.playlist.length === 0) return;

            let nextIndex;
            if (state.isShuffle) {
                nextIndex = Math.floor(Math.random() * state.playlist.length);
            } else {
                nextIndex = (state.currentIndex + 1) % state.playlist.length;
            }

            loadSong(nextIndex);
            if (!state.isPlaying) {
                state.isPlaying = true;
                updatePlayButton();
                state.audio.play();
            }
        }

        // Play previous song
        function playPrev() {
            if (state.playlist.length === 0) return;

            const prevIndex = (state.currentIndex - 1 + state.playlist.length) % state.playlist.length;
            loadSong(prevIndex);
            if (!state.isPlaying) {
                state.isPlaying = true;
                updatePlayButton();
                state.audio.play();
            }
        }

        // Toggle shuffle
        function toggleShuffle() {
            state.isShuffle = !state.isShuffle;
            elements.shuffleBtn.style.background = state.isShuffle ? 'rgba(102, 126, 234, 0.5)' : 'rgba(255, 255, 255, 0.1)';
        }

        // Toggle repeat mode
        function toggleRepeat() {
            state.repeatMode = (state.repeatMode + 1) % 3;
            if (state.repeatMode === 0) {
                elements.repeatBtn.style.background = 'rgba(255, 255, 255, 0.1)';
                elements.repeatBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>';
            } else if (state.repeatMode === 1) {
                elements.repeatBtn.style.background = 'rgba(102, 126, 234, 0.5)';
                elements.repeatBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/><text x="12" y="14" text-anchor="middle" fill="currentColor" font-size="8">1</text></svg>';
            } else {
                elements.repeatBtn.style.background = 'rgba(102, 126, 234, 0.5)';
                elements.repeatBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/><text x="12" y="14" text-anchor="middle" fill="currentColor" font-size="8">‚àû</text></svg>';
            }
        }

        // Update progress bar
        function updateProgress() {
            const percent = (state.audio.currentTime / state.audio.duration) * 100;
            elements.progressFill.style.width = `${percent}%`;
            elements.currentTime.textContent = formatTime(state.audio.currentTime);
        }

        // Seek to position
        function seek(e) {
            if (state.playlist.length === 0) return;

            const rect = elements.progressBar.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            state.audio.currentTime = percent * state.audio.duration;
        }

        // Set volume
        function setVolume(e) {
            const rect = elements.volumeSlider.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            state.volume = Math.max(0, Math.min(1, percent));
            state.audio.volume = state.volume;
            elements.volumeFill.style.width = `${state.volume * 100}%`;
        }

        // Add songs to playlist
        function addSongs(files) {
            Array.from(files).forEach(file => {
                const song = {
                    id: Date.now() + Math.random(),
                    title: file.name.replace(/\.[^/.]+$/, ''),
                    artist: 'Êú¨Âú∞Êñá‰ª∂',
                    url: URL.createObjectURL(file),
                    duration: 0
                };

                // Get duration
                const tempAudio = new Audio(song.url);
                tempAudio.addEventListener('loadedmetadata', () => {
                    song.duration = tempAudio.duration;
                    updatePlaylistUI();
                });

                state.playlist.push(song);
            });

            updatePlaylistUI();

            // Load first song if not loaded
            if (state.currentIndex === 0 && state.playlist.length > 0) {
                loadSong(0);
            }
        }

        // Remove song from playlist
        function removeSong(id, e) {
            e.stopPropagation();
            const index = state.playlist.findIndex(s => s.id === id);
            if (index > -1) {
                URL.revokeObjectURL(state.playlist[index].url);
                state.playlist.splice(index, 1);

                if (state.playlist.length === 0) {
                    state.audio.pause();
                    state.isPlaying = false;
                    updatePlayButton();
                    elements.currentTitle.textContent = 'ÈÄâÊã©‰∏ÄÈ¶ñÊ≠åÊõ≤';
                    elements.currentArtist.textContent = '--';
                } else if (index === state.currentIndex) {
                    loadSong(Math.min(index, state.playlist.length - 1));
                } else if (index < state.currentIndex) {
                    state.currentIndex--;
                }

                updatePlaylistUI();
            }
        }

        // Update playlist UI
        function updatePlaylistUI() {
            if (state.playlist.length === 0) {
                elements.playlistItems.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                        </svg>
                        <p>Êí≠ÊîæÂàóË°®‰∏∫Á©∫</p>
                        <p style="font-size: 12px; margin-top: 8px;">ÁÇπÂáª"Ê∑ªÂä†Ê≠åÊõ≤"ÂºÄÂßã</p>
                    </div>
                `;
                return;
            }

            elements.playlistItems.innerHTML = state.playlist.map((song, index) => `
                <div class="playlist-item ${index === state.currentIndex ? 'active' : ''} ${index === state.currentIndex && state.isPlaying ? 'playing' : ''}"
                     onclick="loadSong(${index})">
                    <div class="item-icon">${index === state.currentIndex && state.isPlaying ? '‚ñ∂' : 'üéµ'}</div>
                    <div class="item-info">
                        <div class="item-title">${song.title}</div>
                        <div class="item-artist">${song.artist}</div>
                    </div>
                    <div class="item-duration">${formatTime(song.duration)}</div>
                    <button class="remove-btn" onclick="removeSong(${song.id}, event)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>
            `).join('');
        }

        // Event Listeners
        elements.playBtn.addEventListener('click', togglePlay);
        elements.prevBtn.addEventListener('click', playPrev);
        elements.nextBtn.addEventListener('click', playNext);
        elements.shuffleBtn.addEventListener('click', toggleShuffle);
        elements.repeatBtn.addEventListener('click', toggleRepeat);
        elements.progressBar.addEventListener('click', seek);
        elements.volumeSlider.addEventListener('click', setVolume);

        elements.addSongBtn.addEventListener('click', () => {
            elements.fileInput.click();
        });

        elements.fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                addSongs(e.target.files);
            }
        });

        // Audio events
        state.audio.addEventListener('timeupdate', updateProgress);
        state.audio.addEventListener('loadedmetadata', () => {
            elements.duration.textContent = formatTime(state.audio.duration);
        });

        state.audio.addEventListener('ended', () => {
            if (state.repeatMode === 2) {
                // Repeat one
                state.audio.currentTime = 0;
                state.audio.play();
            } else if (state.repeatMode === 1 || state.currentIndex < state.playlist.length - 1) {
                // Repeat all or not last song
                playNext();
            } else {
                // End of playlist
                state.isPlaying = false;
                updatePlayButton();
            }
        });

        state.audio.addEventListener('error', () => {
            console.error('Audio playback error');
            state.isPlaying = false;
            updatePlayButton();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return;

            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    togglePlay();
                    break;
                case 'ArrowRight':
                    if (e.shiftKey) playNext();
                    else state.audio.currentTime += 10;
                    break;
                case 'ArrowLeft':
                    if (e.shiftKey) playPrev();
                    else state.audio.currentTime -= 10;
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    state.audio.volume = Math.min(1, state.audio.volume + 0.1);
                    elements.volumeFill.style.width = `${state.audio.volume * 100}%`;
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    state.audio.volume = Math.max(0, state.audio.volume - 0.1);
                    elements.volumeFill.style.width = `${state.audio.volume * 100}%`;
                    break;
            }
        });

        // Initialize volume
        state.audio.volume = state.volume;
    </script>
</body>
</html>
