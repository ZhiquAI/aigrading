# 评分细则管理系统深度设计方案 (Rubric Management System)

## 1. 核心业务流程 (Core Workflow)
系统应摒弃“手动编写”的低效模式，转为 **“AI 生产 -> 人工校准 -> 标准化分发”** 的资产流转模式。

1.  **原料输入**：老师提供“试题图片/文本” + “参考答案图片/文本” + “原始标准（可选）”。
2.  **AI 内化与优化**：AI 研读上述材料，生成一份具备高可执行性的“AI 阅卷操作手册”。
3.  **人工微调**：老师在侧边栏通过“垂直联动视图”对得分点和关键词进行微调。
4.  **持久化与分发**：保存为标准化 JSON，支持导出给其他老师或跨设备导入。

## 2. AI 提示词策略 (Prompt Engineering)

### 2.1 二维策略矩阵
阅卷逻辑由 **“学科特性”** 与 **“题型逻辑”** 共同决定：

| 维度 | 策略重点 |
| :--- | :--- |
| **学科：文科** | 重意不重形，强调“同义词库”扩展和语义模糊匹配。 |
| **学科：理科** | 逻辑追踪，识别关键公式，处理“步骤分”与“错误传递”。 |
| **题型：填空** | **严格模式**：字面完全一致，对错别字、多字少字进行拦截。 |
| **题型：简答** | **采点模式**：关键词命中即得分，不要求句子完整。 |
| **题型：论述** | **分档模式**：多维度打分（立意、论证、表达），给出详细扣分理由。 |

### 2.2 阅卷校准 (Calibration)
在正式批改前，必须将“试题+答案+原始标准”三合一提交给 AI，使其理解语境，消除幻觉，预测学生可能的边缘表达。

### 2.3 全局偏好注入 (Implicit Rules)
支持设置全局“阅卷习惯”，动态注入 System Prompt：
*   **卷面分**：字迹整洁度对总分的影响 (±1)。
*   **辛苦分**：字数达标且态度端正的保底分。
*   **错别字容忍度**：[ 忽略 | 扣分 | 零分 ]。

## 3. 交互设计 (UX/UI) - 适配 Chrome Side Panel

### 3.1 垂直流式对比 (Vertical Flow Diff)
由于侧边栏空间有限，不采用左右分栏，采用**纵向联动**：
*   **顶部固定区**：显示参考答案原文（带滚动条）。
*   **底部编辑区**：显示 AI 生成的结构化得分点卡片。
*   **焦点同步**：点击下方的“得分点”，上方原文自动滚动并高亮对应句子。

### 3.2 多题管理：手风琴列表 (Accordion List)
*   **折叠态**：显示题号、总分、状态灯（🟢已配置/🟠待确认/🔴缺失）。
*   **展开态**：激活“垂直流式对比”编辑器。
*   **锚点导航**：顶部提供横向滚动的题号快速跳转条。

### 3.3 导入/导出中心
*   标准化 JSON Schema，包含元数据、题目特征、防错关键词、执行细则。
*   支持文件拖拽、剪贴板 JSON 字符串粘贴导入。

## 4. 安全防错机制 (Topic Sync Protection)
*   **防错特征词 (Anchor Keywords)**：在生成细则时，自动提取该题独有的 3 个特征词（如“蒸汽机”）。
*   **内容级校验**：阅卷前 AI 确认图片内容包含特征词，否则触发 **“题目不匹配”** 报警，防止错阅。

## 5. 数据标准 (JSON Schema 示例)
```json
{
  "questionNo": "15",
  "subject": "history",
  "type": "short_answer",
  "anchorKeywords": ["权利法案", "限制王权"],
  "points": [
    { "id": "1", "score": 2, "keywords": ["君主立宪", "议会主权"], "desc": "提及确立了君主立宪制" }
  ],
  "globalPreferences": { "handwritingScore": true, "spellingStrictness": "low" }
}
```
